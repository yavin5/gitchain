{"version":3,"file":"main.js","sources":["../src/main.js"],"sourcesContent":["// ---------------------------------------------------------------\n// Wait for the custom init event that bundle.js dispatches\n// ---------------------------------------------------------------\ndocument.addEventListener('DOMContentLoaded', async () => {\n  // Wait a tick for bundle.js to run and set window.gitchain\n  await new Promise(r => setTimeout(r, 0));\n\n  // ---- DOM elements -------------------------------------------------\n  const patInput          = document.getElementById('patInput');\n  const savePatButton     = document.getElementById('savePat');\n  const processTxnsButton = document.getElementById('processTxns');\n  const viewChainButton   = document.getElementById('viewChain');\n  const tokenMessage      = document.getElementById('tokenMessage');\n  const blockHeight       = document.getElementById('blockHeight');\n  const peerIdDisplay     = document.getElementById('peerId');\n  const messageInput      = document.getElementById('message');\n  const sendButton        = document.getElementById('send');\n\n  const rpcUrlInput       = document.getElementById('rpcUrl');\n  const chainIdInput      = document.getElementById('chainId');\n  const generateWalletBtn = document.getElementById('generateWallet');\n  const walletInfoDiv     = document.getElementById('walletInfo');\n  const mnemonicDisplay   = document.getElementById('mnemonic');\n  const kasplexAddress    = document.getElementById('kasplexAddress');\n  const connectPeersBtn   = document.getElementById('connectPeers');\n  const chatDiv           = document.getElementById('chat');\n\n  let signaling   = null;\n  let localPeerId = '';\n  const connections = new Map();\n\n  // ---------------------------------------------------------------\n  // 1. P2P init â€“ shows Peer ID\n  // ---------------------------------------------------------------\n  if (window.gitchain && window.gitchain.initP2P) {\n    window.gitchain.initP2P().then(peerId => {\n      localPeerId = peerId;\n      peerIdDisplay.textContent = `Your Peer ID: ${peerId.slice(-8)}`;\n    });\n  }\n\n  // ---------------------------------------------------------------\n  // 2. Show current block height\n  // ---------------------------------------------------------------\n  if (window.gitchain && window.gitchain.fetchState) {\n    window.gitchain.fetchState().then(state => {\n      if (state && state.content && state.content.chain) {\n        blockHeight.textContent = `Block Height: ${state.content.chain.length}`;\n      } else {\n        blockHeight.textContent = `Block Height: 0`;\n      }\n    });\n  }\n\n  // ---------------------------------------------------------------\n  // 3. PAT handling\n  // ---------------------------------------------------------------\n  if (localStorage.getItem('gitchain_github_access_token')) {\n    tokenMessage.textContent = 'GitHub Personal Access Token saved.';\n    processTxnsButton.classList.remove('hidden');\n  } else {\n    processTxnsButton.classList.add('hidden');\n  }\n\n  savePatButton.addEventListener('click', () => {\n    const token = patInput.value.trim();\n    if (token && window.gitchain && window.gitchain.saveGithubAccessToken) {\n      window.gitchain.saveGithubAccessToken(token).then(() => {\n        tokenMessage.textContent = 'GitHub Personal Access Token saved.';\n        processTxnsButton.classList.remove('hidden');\n      }).catch(err => {\n        tokenMessage.textContent = 'Error saving token: ' + err.message;\n      });\n    }\n  });\n\n  // ---------------------------------------------------------------\n  // 4. Process / View chain\n  // ---------------------------------------------------------------\n  processTxnsButton.addEventListener('click', () => {\n    if (window.gitchain && window.gitchain.processTxns) window.gitchain.processTxns();\n  });\n\n  viewChainButton.addEventListener('click', () => {\n    if (window.gitchain && window.gitchain.viewChain) window.gitchain.viewChain();\n  });\n\n  // ---------------------------------------------------------------\n  // 5. Generate Kasplex wallet\n  // ---------------------------------------------------------------\n  generateWalletBtn.addEventListener('click', () => {\n    // The default is testnet's chain ID.\n    const chain = chainIdInput.value.trim() || '167012';\n\n    signaling = new window.gitchain.KasplexSignalling(chain);\n    const { mnemonic, address } = signaling.generateWallet();\n\n    mnemonicDisplay.textContent   = mnemonic;\n    kasplexAddress.textContent    = address;\n    walletInfoDiv.classList.remove('hidden');\n\n    console.log('Kasplex wallet generated:', { mnemonic, address });\n  });\n\n  // ---------------------------------------------------------------\n  // 6. Connect to peers (after funding)\n  // ---------------------------------------------------------------\n  connectPeersBtn.addEventListener('click', async () => {\n    if (!signaling) return alert('Generate a wallet first.');\n    await signaling.connect();\n\n    const peers = window.gitchain.getServerPeers() || [];\n    for (const peerId of peers) {\n      if (peerId !== localPeerId && !connections.has(peerId)) {\n        const conn = new window.gitchain.WebRTCConnection(signaling, localPeerId, peerId);\n        connections.set(peerId, conn);\n        console.log(`Initiated WebRTC connection to ${peerId.slice(-8)}`);\n      }\n    }\n  });\n\n  // ---------------------------------------------------------------\n  // 7. Chat send\n  // ---------------------------------------------------------------\n  sendButton.addEventListener('click', () => {\n    const msg = messageInput.value.trim();\n    if (!msg) return;\n\n    connections.forEach(conn => conn.send(msg));\n\n    const el = document.createElement('div');\n    el.textContent = `${localPeerId.slice(-8)}: ${msg}`;\n    chatDiv.appendChild(el);\n    chatDiv.scrollTop = chatDiv.scrollHeight;\n    messageInput.value = '';\n  });\n});\n"],"names":[],"mappings":"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"}