{"version":3,"file":"main.js","sources":["../src/main.js"],"sourcesContent":["// Wait for the custom init event that bundle.js dispatches\ndocument.addEventListener('DOMContentLoaded', async () => {\n  // Wait a tick for bundle.js to run.\n  await new Promise(r => setTimeout(r, 300));\n\n  // DOM elements\n  const patInput          = document.getElementById('patInput');\n  const savePatButton     = document.getElementById('savePat');\n  const processTxnsButton = document.getElementById('processTxns');\n  const viewChainButton   = document.getElementById('viewChain');\n  const tokenMessage      = document.getElementById('tokenMessage');\n  const blockHeight       = document.getElementById('blockHeight');\n  const peerIdDisplay     = document.getElementById('peerId');\n  const messageInput      = document.getElementById('message');\n  const sendButton        = document.getElementById('send');\n\n  const generateWalletBtn = document.getElementById('generateWallet');\n  const restoreWalletBtn  = document.getElementById('restoreWallet');\n  const walletInfoDiv     = document.getElementById('walletInfo');\n  const walletStatusSpan  = document.getElementById('walletStatus');\n  const mnemonicDisplay   = document.getElementById('mnemonic');\n  const kaspaAddress      = document.getElementById('kaspaAddress');\n  const connectPeersBtn   = document.getElementById('connectPeers');\n  const chatDiv           = document.getElementById('chat');\n\n  let signaling   = null;\n  let localPeerId = '';\n  const connections = new Map();\n\n  // P2P init – shows Peer ID\n  if (window.gitchain && window.gitchain.initP2P) {\n    window.gitchain.initP2P().then(peerId => {\n      localPeerId = peerId;\n      peerIdDisplay.textContent = `Your Peer ID: ${peerId.slice(-8)}`;\n    });\n  }\n\n  // Show current block height\n  if (window.gitchain && window.gitchain.fetchState) {\n    window.gitchain.fetchState().then(state => {\n      if (state && state.content && state.content.chain) {\n        blockHeight.textContent = `Block Height: ${state.content.chain.length}`;\n      } else {\n        blockHeight.textContent = `Block Height: 0`;\n      }\n    });\n  }\n\n  // PAT handling\n  if (localStorage.getItem('gitchain_github_access_token')) {\n    tokenMessage.textContent = 'GitHub Personal Access Token saved.';\n    processTxnsButton.classList.remove('hidden');\n  } else {\n    processTxnsButton.classList.add('hidden');\n  }\n\n  savePatButton.addEventListener('click', () => {\n    const token = patInput.value.trim();\n    if (token && window.gitchain && window.gitchain.saveGithubAccessToken) {\n      window.gitchain.saveGithubAccessToken(token).then(() => {\n        tokenMessage.textContent = 'GitHub Personal Access Token saved.';\n        processTxnsButton.classList.remove('hidden');\n      }).catch(err => {\n        tokenMessage.textContent = 'Error saving token: ' + err.message;\n      });\n    }\n  });\n\n  // Process / View chain\n  processTxnsButton.addEventListener('click', () => {\n    if (window.gitchain && window.gitchain.processTxns) window.gitchain.processTxns();\n  });\n\n  viewChainButton.addEventListener('click', () => {\n    if (window.gitchain && window.gitchain.viewChain) window.gitchain.viewChain();\n  });\n\n  // Generate Kaspa wallet\n  generateWalletBtn.addEventListener('click', () => {\n    console.log(\"Clicked generate wallet button.\");\n    console.log(\"About to instantiate KaspaSignaling.\");\n    walletStatusSpan.innerHTML = `<p style=\"blinking\">Please wait, connecting..</p>`;\n\n    // Sleep some ticks to let chain.ts run.\n    new Promise((r) => setTimeout(r, 1000)).then(async () => {\n\n      signaling = new window.gitchain.KaspaSignaling(\"testnet-10\", async () => {\n        const walletInfoDiv = document.getElementById('walletInfo');\n        console.log(\"walletInfoDiv: \" + walletInfoDiv);\n        walletStatusSpan.innerHTML = `Generating new wallet..`;\n\n        try {\n          const { mnemonic, address } = await signaling.generateWallet();\n          console.log(\"Generated wallet: \" + mnemonic + \" \" + address);\n          mnemonicDisplay.textContent = mnemonic;\n          kaspaAddress.textContent = address;\n          walletInfoDiv.classList.remove(\"hidden\");\n\n          walletInfoDiv.innerHTML = `\n            <strong>Address:</strong> ${address}<br>\n            <strong>Mnemonic (keep secret):</strong><br>\n            <code style=\"word-break:break-all;\">${mnemonic}</code>\n          `;\n          walletStatusSpan.innerHTML = `New wallet generated!`;\n        } catch (err) {\n          walletInfoDiv.textContent = 'Error: ' + err.message;\n        }\n      });\n      // Expose signaling object for other parts of the app\n      window.gitchain.kaspaSignalingInstance = signaling;\n    });\n  });\n\n  // Restore an existing Kaspa wallet\n  restoreWalletBtn.addEventListener('click', () => {\n    console.log(\"Clicked restore wallet button.\");\n    console.log(\"About to instantiate KaspaSignaling.\");\n    walletStatusSpan.innerHTML = `<p style=\"blinking\">Please wait, connecting..</p>`;\n\n    // Sleep some ticks to let chain.ts run.\n    new Promise((r) => setTimeout(r, 1000)).then(async () => {\n\n      signaling = new window.gitchain.KaspaSignaling(\"testnet-10\", async () => {\n        walletStatusSpan.innerHTML = `Restoring wallet..`;\n        const walletAddressRestoredDiv = document.getElementById('walletAddressRestored');\n        console.log(\"walletAddressRestoredDiv: \" + walletAddressRestoredDiv);\n        walletAddressRestoredDiv.classList.remove(\"hidden\");\n        const addressText = document.getElementById('addressText');\n        addressText.textContent = 'Restoring…';\n\n        try {\n          console.log(\"signaling: \" + signaling);\n          await signaling.restoreWallet();\n          walletStatusSpan.innerHTML = `Wallet restored!`;\n        } catch (err) {\n          addressText.textContent = 'Error: ' + err.message;\n        }\n      });\n\n      // Expose signaling object for other parts of the app\n      window.gitchain.kaspaSignalingInstance = signaling;\n    });\n  });\n\n  // Connect to peers (after funding)\n  connectPeersBtn.addEventListener('click', async () => {\n    if (!signaling) return alert('Generate a wallet first.');\n\n    const peers = window.gitchain.getServerPeers() || [];\n    for (const peerId of peers) {\n      if (peerId !== localPeerId && !connections.has(peerId)) {\n        const conn = new window.gitchain.WebRTCConnection(signaling, localPeerId, peerId);\n        connections.set(peerId, conn);\n        console.log(`Initiated WebRTC connection to ${peerId.slice(-8)}`);\n      }\n    }\n  });\n\n  // Chat send\n  sendButton.addEventListener('click', () => {\n    const msg = messageInput.value.trim();\n    if (!msg) return;\n\n    connections.forEach(conn => conn.send(msg));\n\n    const el = document.createElement('div');\n    el.textContent = `${localPeerId.slice(-8)}: ${msg}`;\n    chatDiv.appendChild(el);\n    chatDiv.scrollTop = chatDiv.scrollHeight;\n    messageInput.value = '';\n  });\n});\n"],"names":[],"mappings":"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"}