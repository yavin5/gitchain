<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gitchain</title>
  <meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://esm.sh 'unsafe-inline';
        connect-src 'self' https://api.github.com https://raw.githubusercontent.com https://rpc.testnet.kasplex.org;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data:;
      ">
  <link rel="stylesheet" href="styles.css">
  <style>
    .spacer { margin-bottom: 1rem; }
    .hidden { display: none; }
    #message { width: 80%; height: 50px; }
    #chat { border: 1px solid #ccc; height: 200px; overflow-y: auto; margin-top: 1rem; }
    .kasplex-section { border: 1px solid #ddd; padding: 1rem; margin: 1rem 0; }
    .mnemonic { font-family: monospace; background: #f5f5f5; padding: 0.5rem; word-break: break-all; }
    .warning { color: red; font-size: 0.8rem; }
  </style>
</head>
<body>
  <h1>Gitchain</h1>

  <!-- Existing GitHub PAT Section -->
  <div>
    <input type="text" id="patInput" placeholder="Enter GitHub Personal Access Token">
    <button id="savePat">Save Personal Access Token</button>
  </div>
  <div id="tokenMessage"></div>
  <button id="processTxns" class="hidden">Process Transactions</button>
  <button id="viewChain">View Chain</button>
  <div id="blockHeight" class="spacer"></div>
  <div id="peerId" class="spacer"></div>

  <!-- New Kasplex Signaling Section -->
  <div class="kasplex-section">
    <h2>Kasplex Relay</h2>
    <label>Chain ID: <input type="text" id="chainId" value="167012"></label> <button id="generateWallet">Generate Wallet</button>
    <div id="walletInfo" class="hidden">
      <p><strong>Warning: Save these seed words ONLY on paper, not share!</strong> <span class="warning">Loss means lost funds on mainnet.</span></p>
      <p class="mnemonic" id="mnemonic"></p>
      <p><strong>Address:</strong> <span id="kasplexAddress"></span></p>
      <a href="https://app.kaspafinance.io/faucets" target="_blank">Get tKAS from Faucet (paste address, claim once)</a><br>
      <button id="connectPeers">Funded? Connect to Peers</button>
    </div>
  </div>

  <!-- Chat Section -->
  <div>
    <textarea id="message" placeholder="Type your message..."></textarea>
    <button id="send">Send</button>
  </div>
  <div id="chat"></div>
  <div id="output" class="hidden"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script type="module">
    import { ec } from 'https://esm.sh/elliptic@6.6.1';
    window.ec = ec;
  </script>
  <script type="module">
    import * as wasm from './kaspa-web/kaspa-web-wasm.js';
    (async () => {
        await wasm.default('./kaspa-web/kaspa-web-wasm_bg.wasm');
        console.log(wasm.version());
    })();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/js-sha3@0.8.0/src/sha3.min.js"></script>

  <!-- Our code â€“ **bundle.js is the Vite output** -->
  <script type="module" src="./js/bundle.js"></script>
  <script type="module" src="./js/main.js"></script>
</body>
</html>
