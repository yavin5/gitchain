<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gitchain</title>
  <meta http-equiv="Content-Security-Policy"
      content="
        default-src 'self';
        script-src 'self' https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://esm.sh 'unsafe-inline' 'wasm-unsafe-eval';
        connect-src 'self' https://cdn.jsdelivr.net https://api.github.com https://raw.githubusercontent.com https://api-tn10.kaspa.org https://faucet-tn10.kaspanet.io;
        style-src 'self' 'unsafe-inline';
        img-src 'self' data:;
      ">
  <link rel="stylesheet" href="styles.css">
  <style>
    .spacer { margin-bottom: 1rem; }
    .hidden { display: none; }
    #message { width: 80%; height: 50px; }
    #chat { border: 1px solid #ccc; height: 200px; overflow-y: auto; margin-top: 1rem; }
    .kaspa-section { border: 1px solid #ddd; padding: 1rem; margin: 1rem 0; }
    .mnemonic { font-family: monospace; background: #f5f5f5; padding: 0.5rem; word-break: break-all; }
    .warning { color: red; font-size: 0.8rem; }
  </style>
</head>
<body>
  <h1>Gitchain</h1>

  <!-- Existing GitHub PAT Section -->
  <div>
    <input type="text" id="patInput" placeholder="Enter GitHub Personal Access Token">
    <button id="savePat">Save Personal Access Token</button>
  </div>
  <div id="tokenMessage"></div>
  <button id="processTxns" class="hidden">Process Transactions</button>
  <button id="viewChain">View Chain</button>
  <div id="blockHeight" class="spacer"></div>
  <div id="peerId" class="spacer"></div>

  <!-- New Kaspa Signaling Section -->
  <div class="kaspa-section">
    <h2>Kaspa Relay</h2>
    <button id="generateWallet">Generate New Wallet</button>
    <div id="walletInfo" class="hidden">
      <p><strong>Warning: Save these seed words ONLY on paper, not share!</strong> <span class="warning">Loss means lost funds on mainnet.</span></p>
      <p class="mnemonic" id="mnemonic"></p>
      <p><strong>Address:</strong> <span id="kaspaAddress"></span></p>
      <a href="https://faucet-tn10.kaspanet.io" target="_blank">Get tKAS from Faucet (paste address, claim once)</a><br>
      <button id="connectPeers">Funded? Connect to Peers</button>
    </div>
  </div>

  <!-- Chat Section -->
  <div>
    <textarea id="message" placeholder="Type your message..."></textarea>
    <button id="send">Send</button>
  </div>
  <div id="chat"></div>
  <div id="output" class="hidden"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
  <script type="module">
    import { ec } from 'https://esm.sh/elliptic@6.6.1';
    window.ec = ec;
  </script>
  <script type="module">
      import * as KaspaSDK from '/@kasstamp/sdk';

// enabling console panic hooks allows WASM to print panic details to console
// initConsolePanicHook();
// enabling browser panic hooks will create a full-page DIV with panic details
// this is useful for mobile devices where console is not available
// initBrowserPanicHook();

// if port is not specified, it will use the default port for the specified network
const rpc = new KaspaSDK.RpcClient({
  url: '127.0.0.1',
  encoding: Encoding.Borsh,
  network: 'testnet-10',
});

(async () => {
  try {
    await rpc.connect();
    let info = await rpc.getInfo();
    console.log(info);
  } finally {
    await rpc.disconnect();
  }
})
  </script>
  <script src="https://cdn.jsdelivr.net/npm/js-sha3@0.8.0/src/sha3.min.js"></script>

  <!-- Our code â€“ **bundle.js is the Vite output** -->
  <script type="module" src="./js/bundle.js"></script>
  <script type="module" src="./js/main.js"></script>
</body>
</html>
